<div class="headless-edit-webhook-overlay" ng-controller="Umbraco.Editors.Webhooks.EditController as vm">
  <umb-editor-view>
    <ng-form name="editWebhookForm" novalidate val-form-manager>
      <umb-editor-header
        name="model.title"
        name-locked="true"
        hide-alias="true"
        hide-icon="true"
        hide-description="true">
      </umb-editor-header>
      <umb-editor-container>
        <umb-box>
          <umb-box-content>
            <umb-load-indicator ng-if="vm.loading"></umb-load-indicator>
            <div ng-hide="vm.loading" style="margin-top: 20px;">

              <umb-control-group
                  label="Url"
                  description="The url to call when the webhook is triggered."
                  alias="webhookUrl"
                  required="true">

                <input type="url"
                       data-element="webhook-url"
                       name="webhookUrl"
                       ng-model="model.webhook.url"
                       class="umb-property-editor umb-textstring"
                       no-dirty-check
                       focus-on-filled="true"
                       placeholder="https://example.com/api/webhook"
                       umb-auto-focus
                       required/>

              </umb-control-group>

              <umb-control-group
                  label="Events"
                  description="The events for which the webhook should be triggered."
                  alias="webhookEvents"
                  required="true">

                <umb-node-preview
                  ng-repeat="event in model.webhook.events"
                  ng-show="event"
                  icon="icon-flag"
                  name="event.eventName"
                  alias="event.eventName"
                  description=""
                  allow-remove="true"
                  allow-open="false"
                  on-remove="vm.clearEvent(event)">
                </umb-node-preview>
                <button type="button"
                   class="umb-node-preview-add"
                   ng-click="vm.openEventPicker()">
                  <localize key="general_add">Add</localize>
                </button>

              </umb-control-group>

              <umb-control-group
                  label="Content Type"
                  description="Only trigger the webhook for a specific content type."
                  alias="webhookContentType">

                <umb-node-preview
                  ng-repeat="contentType in model.contentTypes"
                  ng-show="contentType"
                  icon="contentType.icon"
                  name="contentType.name"
                  alias="contentType.alias"
                  description="contentType.description"
                  allow-remove="true"
                  allow-open="false"
                  on-remove="vm.clearContentType(contentType.key)">
                </umb-node-preview>

                <button type="button"
                   class="umb-node-preview-add"
                   ng-disabled="!model.webhook.events || model.webhook.events.length === 0"
                   ng-click="vm.openContentTypePicker()">
                  <span ng-if="model.webhook.events && model.webhook.events.length !== 0">
                    <localize key="general_add">Add</localize>
                  </span>
                  <span ng-if="!model.webhook.events || model.webhook.events.length === 0">
                    Please select an event first.
                  </span>
                </button>

              </umb-control-group>

              <umb-control-group label="Enabled" description="Is the webhook enabled?" alias="webhookEnabled">
                <umb-toggle
                  checked="model.webhook.enabled"
                  on-click="model.webhook.enabled = !model.webhook.enabled">
                </umb-toggle>
              </umb-control-group>
              <umb-control-group
                  label="Headers"
                  description="Custom headers to include in the webhook request."
                  alias="webhookHeaders">

                <table class="table table-hover" ng-if="!vm.loading">
                  <thead>
                  <tr>
                    <th>Name</th>
                    <th>Value</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr ng-repeat="(key, value) in model.webhook.headers">
                    <td>{{key}}</td>
                    <td>{{value}}</td>
                    <td style="text-align: right;">
                      <umb-button
                        type="button"
                        button-style="danger"
                        label-key="general_delete" ,
                        size="xxs"
                        action="vm.removeHeader(key)">
                      </umb-button>
                    </td>
                  </tr>
                  </tbody>
                </table>
                <umb-button
                  type="button"
                  action="vm.openCreateHeader()"
                  button-style="outline"
                  label-key="webhooks_addWebhookHeader">
                </umb-button>

              </umb-control-group>
            </div>
          </umb-box-content>
        </umb-box>
      </umb-editor-container>
      <umb-editor-footer>
        <umb-editor-footer-content-right>
          <umb-button
            type="button"
            button-style="link"
            label-key="general_close"
            shortcut="esc"
            action="vm.close()">
          </umb-button>
          <umb-button
            type="button"
            button-style="action"
            disabled="disableSubmitButton"
            label="{{model.submitButtonLabel}}"
            state="model.submitButtonState"
            action="vm.submit()">
          </umb-button>
        </umb-editor-footer-content-right>
      </umb-editor-footer>
    </ng-form>
  </umb-editor-view>
</div>
